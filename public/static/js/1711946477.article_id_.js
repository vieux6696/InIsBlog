import{M as e}from"./1711946477.markdown-it.js";import{_ as t,u as l,a as s,n as i,b as a,c as n,p as o}from"./1711946477.index.js";import{a6 as r,aj as d,o as c,f as m,a2 as u,a as p,s as v,J as g,aA as f,aB as y,y as h,w as x,c as b,i as w,m as k,F as j,g as _,q as z,a3 as V,K as q,as as C,l as $,T,j as L}from"./1711946477.@vue.js";import{V as F}from"./1711946477.vditor.js";import{_ as I}from"./1711946477.i-markdown.js";import{C as U}from"./1711946477.@fancyapps.js";import{b as M}from"./1711946477.vue-router.js";import"./1711946477.crypto-js.js";import"./1711946477.entities.js";import"./1711946477.uc.micro.js";import"./1711946477.mdurl.js";import"./1711946477.linkify-it.js";import"./1711946477.punycode.js";import"./1711946477.lscache.js";import"./1711946477.axios.js";import"./1711946477.element-plus.js";import"./1711946477.lodash-es.js";import"./1711946477.@element-plus.js";import"./1711946477.@popperjs.js";import"./1711946477.@ctrl.js";import"./1711946477.dayjs.js";import"./1711946477.async-validator.js";import"./1711946477.memoize-one.js";import"./1711946477.normalize-wheel-es.js";import"./1711946477.@floating-ui.js";import"./1711946477.notyf.js";import"./1711946477.pinia.js";import"./1711946477.lottie-web.js";import"./1711946477.bootstrap.js";import"./1711946477.plyr.js";import"./1711946477.highlight.js.js";import"./1711946477.@howdyjs.js";const S=e=>(f("data-v-6ab92076"),e=e(),y(),e),A=S((()=>p("div",{class:"flex-center"},"分 享 到",-1))),H={class:"container-xxl d-flex justify-content-center align-items-center mt-2"},N=S((()=>p("span",{class:"font-13 mt-1"},"QQ",-1))),P=S((()=>p("span",{class:"font-13 mt-1"},"空间",-1))),Q=S((()=>p("span",{class:"font-13 mt-1"},"微信",-1))),O=S((()=>p("span",{class:"font-13 mt-1"},"微博",-1))),B=t({__name:"share",props:{type:{type:String,default:"theme"},struct:{type:Object,required:!0}},setup(e){const t=r({item:{dialog:!1}}),a=e,n={qq:()=>{var e,t,s,i;const o={url:window.location.href,desc:null==(e=a.struct)?void 0:e.abstract,title:null==(t=a.struct)?void 0:t.title,summary:null==(s=a.struct)?void 0:s.abstract,pics:null==(i=a.struct)?void 0:i.covers,flash:"",site:""},r=`https://connect.qq.com/widget/shareqq/index.html?${l.stringfy(o)}`;window.open(r,"_blank","width=800,height=600"),n.submit()},qzone:()=>{const e={url:window.location.href,desc:l.string.omit(a.struct.abstract,100),title:a.struct.title,summary:"",pics:a.struct.covers,flash:"",site:""};let t=`https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?${l.stringfy(e)}`;window.open(t,"_blank","width=800,height=600"),n.submit()},wechat:()=>{let e=`【${a.struct.title}】${a.struct.abstract} ${window.location.href}`;n.copy(e,"复制成功！"),n.submit()},weibo:()=>{const e={url:window.location.href,title:a.struct.title};let t=`https://service.weibo.com/share/share.php?${l.stringfy(e)}`;window.open(t,"_blank","width=800,height=600"),n.submit()},submit:()=>{var e,t;if(l.is.empty(null==(e=a.struct)?void 0:e.id))return;let i=a.type||"theme";s.post("/api/exp/share",{bind_id:null==(t=a.struct)?void 0:t.id,bind_type:i,state:1})},copy:(e=null,t="")=>{l.is.empty(e)||(l.set.copy.text(e),l.is.empty(t)||i.success(t))}};return(e,l)=>{const s=d("i-svg"),i=d("el-dialog");return c(),m(i,{modelValue:g(t).item.dialog,"onUpdate:modelValue":l[4]||(l[4]=e=>g(t).item.dialog=e),class:"custom sm","close-on-click-modal":!1},{header:u((()=>[A])),default:u((()=>[p("div",H,[p("div",{onClick:l[0]||(l[0]=e=>n.qq()),class:"d-flex flex-column align-items-center px-3 py-1 radius-5 pointer item"},[v(s,{name:"qq",size:"40px"}),N]),p("div",{onClick:l[1]||(l[1]=e=>n.qzone()),class:"d-flex flex-column align-items-center px-3 py-1 radius-5 pointer item"},[v(s,{name:"qzone",size:"40px"}),P]),p("div",{onClick:l[2]||(l[2]=e=>n.wechat()),class:"d-flex flex-column align-items-center px-3 py-1 radius-5 pointer item"},[v(s,{name:"wechat",size:"40px"}),Q]),p("div",{onClick:l[3]||(l[3]=e=>n.weibo()),class:"d-flex flex-column align-items-center px-3 py-1 radius-5 pointer item"},[v(s,{name:"weibo",size:"42px"}),O])])])),footer:u((()=>[])),_:1},8,["modelValue"])}}},[["__scopeId","data-v-6ab92076"]]),J={class:"w-100 py-1 radius-5 comment"},W={key:1,class:"d-flex justify-content-between align-items-center px-2"},D={class:"font-12"},E={class:"tags overflow-y-auto",style:{"max-height":"200px"}},K={__name:"i-comment",props:{pid:{type:Number,default:0},bindType:{type:String,default:"article",required:!0},bindId:{type:Number,default:0,required:!0}},emits:["finish"],setup(e,{emit:t}){const n=t,o=e,{ctx:f,proxy:y}=q();a();const C=r({send:!1,focus:!1,emoji:{show:!1,data:[]},vditor:F,progress:{value:0,show:!1,color:"var(--bs-dark)"}}),$={blur:e=>{l.is.empty(e.relatedTarget)?l.is.empty(C.struct.content)&&(C.focus=!1):y.$refs["el-input"].focus()},focus:()=>{C.focus=!0},insert:e=>{C.vditor.insertValue(e,!0)},vditor:()=>new F(y.$refs.vditor,{minHeight:30,cdn:"/assets/libs/vditor",placeholder:"尊重是评论打动人心的入场券！",toolbar:[],cache:{enable:!1},preview:{hljs:{enable:!0},math:{engine:"MathJax"}},upload:{accept:"image/*, video/*",multiple:!1,handler:async e=>{const t=new FormData;t.append("file",e[0]),C.progress.show=!0;const{code:l,msg:a,data:n}=await s.post("/api/file/upload",t,{onUploadProgress:e=>{C.progress.value=Math.round(e.loaded/e.total*100)}});if(200!==l)return i.error(a),C.progress.color="var(--bs-danger)",void setTimeout((()=>C.progress.show=!1),3e3);const{path:o}=n;"image"===$.fileFormat(o)?C.vditor.insertValue(`![](${o})`):"video"===$.fileFormat(o)?C.vditor.insertValue(`<video src="${o}" controls>Not Support</video>`):C.vditor.insertValue(`${o}`),C.progress.show=!1},filename:e=>e.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5.)]/g,"").replace(/[?\\/:|<>*\[\]()$%{}@~]/g,"").replace("/\\s/g","")},focus:()=>{C.focus=!0},blur:()=>{C.focus=!l.is.empty(C.vditor.getValue())},input:e=>{C.send=!l.is.empty(e)}}),fileFormat(e=null){let t="other";const s=e.split(".").pop();return l.in.array(s,["png","jpg","jpeg","gif","webp","svg","ico"])?t="image":l.in.array(s,["avi","mp4"])&&(t="video"),t},emoji:async()=>{const{data:e}=await s.get("/api/file/emoji");C.emoji.data=e},name:e=>({qq:"QQ",bilibili:"B站",tiktok:"抖音"}[e]||e),send:async()=>{const e=C.vditor.getValue();if(l.is.empty(e))return i.warn("评论内容不能为空");const{code:t,msg:a}=await s.post("/api/comment/create",{content:e,bind_id:o.bindId,bind_type:o.bindType,pid:o.pid,editor:"markdown"});if(200!==t)return i.error(a);C.vditor.setValue(""),C.send=!1,C.focus=!1,n("finish")}};return h((()=>{C.vditor=$.vditor(),$.emoji()})),x((()=>C.emoji.data),(e=>{C.emoji.show=!l.is.empty(e)})),(e,t)=>{const l=d("el-progress"),s=d("el-image"),i=d("el-tab-pane"),a=d("el-tabs"),n=d("i-svg"),o=d("el-button"),r=d("el-popover");return c(),b("div",J,[g(C).progress.show?(c(),m(l,{key:0,percentage:g(C).progress.value,color:g(C).progress.color},null,8,["percentage","color"])):w("",!0),p("div",k(e.$attrs,{ref:"vditor"}),null,16),g(C).focus?(c(),b("div",W,[v(r,{placement:"bottom",width:300,trigger:"click",class:"p-0"},{reference:u((()=>[v(o,{class:"p-0",style:{height:"20px",width:"20px"},size:"small"},{default:u((()=>[v(n,{name:"emoji",color:"#8a8a8a",size:"15px"})])),_:1})])),default:u((()=>[v(a,{"active-name":"qq","tab-position":"bottom",class:"comment-box"},{default:u((()=>[(c(!0),b(j,null,_(g(C).emoji.data,((e,t)=>(c(),m(i,{key:t,name:t},{label:u((()=>[p("span",D,z($.name(t)),1)])),default:u((()=>[p("div",E,[(c(!0),b(j,null,_(e,((e,t)=>(c(),b("small",{key:t,class:"p-1 white-space-nowrap user-select-none"},[v(s,{onClick:t=>$.insert(`![](${e})`),src:e,fit:"cover",style:{width:"24px",height:"24px"},class:"pointer item"},null,8,["onClick","src"])])))),128))])])),_:2},1032,["name"])))),128))])),_:1})])),_:1}),v(o,{onClick:t[0]||(t[0]=e=>$.send()),disabled:!g(C).send,type:"primary",size:"small",class:"btn btn-info text-white",style:{"line-height":"0"}},{default:u((()=>[V(" 发送 ")])),_:1},8,["disabled"])])):w("",!0)])}}},X={class:"card mb-lg-3 mb-2"},Y={class:"card-body"},Z={key:0},G={key:0,class:"d-flex align-items-center"},R={class:"me-2"},ee={key:1,class:"d-flex flex-column justify-content-center align-items-center"},te={class:"d-flex align-items-center"},le=p("small",{class:"ms-1"},"登 录",-1),se=p("span",{class:"mt-2",style:{color:"#999"}},"喜欢这篇文章吗？",-1),ie=p("small",{style:{color:"#999"}},"别忘了点赞或赞赏，让我知道创作的路上有你陪伴！",-1),ae={class:"d-flex justify-content-between align-items-center mt-2"},ne={key:2,class:"user-select-none"},oe={class:"d-flex align-items-center"},re={class:"mx-1 font-13 fw-bolder"},de={class:"d-flex"},ce={class:"ms-4 user-select-text comment markdown"},me=["innerHTML"],ue={key:2},pe={class:"d-flex ms-4 py-1 justify-content-between"},ve={class:"d-flex text-muted"},ge=["onClick"],fe={class:"ms-1",style:{"line-height":"20px","margin-bottom":"2px"}},ye=["onClick"],he=p("small",{class:"ms-1",style:{"line-height":"20px"}},"回复",-1),xe={class:"d-flex"},be={key:0,class:"ps-3 pb-1"},we={key:1,class:"text-bg-muted ms-3 py-2 radius-5"},ke={class:"d-flex align-items-center"},je={class:"mx-1 font-13 fw-bolder"},_e={class:"d-flex"},ze={class:"ms-4 user-select-text comment markdown"},Ve=["innerHTML"],qe={key:2},Ce={class:"d-flex ms-4 py-1 justify-content-between"},$e={class:"d-flex text-muted"},Te=["onClick"],Le={class:"ms-1",style:{"line-height":"20px","margin-bottom":"2px"}},Fe=["onClick"],Ie=p("small",{class:"ms-1",style:{"line-height":"20px"}},"回复",-1),Ue={class:"d-flex"},Me={key:0,class:"ms-3 mb-1 box-shadow"},Se={key:3,class:"mb-0 d-flex align-items-center flex-column"},Ae=p("p",{class:"separator mb-0 text-muted"},"暂无内容",-1),He={class:"flex-center"},Ne={__name:"body",props:{modelValue:{type:Number,required:!0},type:{type:String,default:"article",required:!1},total:{type:Number,default:0,required:!1}},setup(e){const t=e,n={comm:a()},o=r({order:{just:!1},comment:{load:!0,show:!0,list:[],page:1,total:1,limit:10,pid:0}}),u={init:async(e=o.comment.page)=>{o.comment.load=!0;const{data:l}=await s.get("/api/comment/flat",{order:o.order.just?"id asc":"id desc",bind_id:t.modelValue,bind_type:t.type,page:e,limit:o.comment.limit}),{page:i,data:a}=l;o.comment.load=!1,o.comment.list=a,o.comment.total=i,o.comment.page=parseInt(e)},change:async e=>{o.comment.page=parseInt(e),await u.init(e)},setPid:e=>{n.comm.login.finish?o.comment.pid=e===o.comment.pid?0:e:n.comm.switchAuth("login",!0)},setLike:async e=>{if(!n.comm.login.finish)return void n.comm.switchAuth("login",!0);const{code:t,msg:l}=await s.post("/api/exp/like",{bind_type:"comment",bind_id:e});if(200!==t)return i.info(l);u.init()},finish:()=>{o.comment.pid=0,u.init()}};return x((()=>t.modelValue),(e=>{l.is.empty(e)||u.init()})),x((()=>o.order.just),(()=>{o.comment.page=1,u.init()})),x((()=>o.comment.list),(e=>{o.comment.show=!l.is.empty(e)})),(e,s)=>{var i;const a=d("el-avatar"),r=d("i-svg"),f=d("el-switch"),y=d("el-pagination"),h=C("loading");return c(),b("div",X,[p("div",Y,[n.comm.login.finish?(c(),b("div",Z,[0===g(o).comment.pid?(c(),b("div",G,[p("span",R,[v(a,{src:null==(i=n.comm.login.user)?void 0:i.avatar,size:30,class:"avatar-shadow"},null,8,["src"])]),v(K,{"bind-id":t.modelValue,"bind-type":t.type,onFinish:u.finish,class:"text-bg-muted"},null,8,["bind-id","bind-type","onFinish"])])):w("",!0)])):(c(),b("div",ee,[p("button",{onClick:s[0]||(s[0]=e=>n.comm.switchAuth("login",!0)),type:"button",class:"btn mx-1 btn-auto mimic action",style:{"border-radius":"200px",padding:"5px 15px"}},[p("span",te,[v(r,{name:"user",size:"20px",color:"rgb(var(--theme-color))"}),le])]),se,ie])),p("div",ae,[p("span",null,"评论 "+z(g(l).format.number(t.total)||0),1),v(f,{modelValue:g(o).order.just,"onUpdate:modelValue":s[1]||(s[1]=e=>g(o).order.just=e),width:"60","inline-prompt":"","active-text":"正序","inactive-text":"倒序"},null,8,["modelValue"])]),g(o).comment.show?$((c(),b("div",ne,[(c(!0),b(j,null,_(g(o).comment.list,(e=>{var s,i,d,f,y,h,x,k,V;return c(),b("div",{key:e.id,class:"py-1"},[p("div",oe,[v(a,{src:null==(i=null==(s=e.result)?void 0:s.author)?void 0:i.avatar,class:"avatar-shadow",size:30},null,8,["src"]),p("span",re,z((null==(f=null==(d=e.result)?void 0:d.author)?void 0:f.nickname)||"无昵称"),1)]),p("div",de,[p("span",ce,["markdown"===e.editor?(c(),m(I,{key:0,modelValue:e.content,"onUpdate:modelValue":t=>e.content=t},null,8,["modelValue","onUpdate:modelValue"])):"html"===e.editor?(c(),b("span",{key:1,innerHTML:e.content},null,8,me)):(c(),b("span",ue,z(e.content),1))])]),p("div",pe,[p("div",ve,[p("span",{onClick:t=>u.setLike(e.id),class:"d-flex align-items-center font-13 pe-2 pointer"},[g(l).in.array(null==(y=n.comm.login.user)?void 0:y.id,null==(x=null==(h=e.result)?void 0:h.like)?void 0:x.uids)?(c(),m(r,{key:1,name:"like",size:"15px",color:"red",style:{"margin-bottom":"3px"}})):(c(),m(r,{key:0,name:"like-outline",size:"15px",color:"#8a8a8a",style:{"margin-bottom":"3px"}})),p("span",fe,z((null==(V=null==(k=e.result)?void 0:k.like)?void 0:V.count)||0),1)],8,ge),p("span",{onClick:t=>u.setPid(e.id),class:"d-flex align-items-center font-13 pointer"},[v(r,{name:"comment-outline-1",size:"14px",color:"#8a8a8a"}),he],8,ye)]),p("div",xe,[p("span",null,z(g(l).natureTime(e.create_time)),1)])]),g(o).comment.pid===e.id?(c(),b("div",be,[v(K,{"bind-id":t.modelValue,"bind-type":t.type,pid:e.id,onFinish:u.finish,class:"text-bg-muted"},null,8,["bind-id","bind-type","pid","onFinish"])])):w("",!0),g(l).is.empty(null==e?void 0:e.replies)?w("",!0):(c(),b("div",we,[(c(!0),b(j,null,_(null==e?void 0:e.replies,(e=>{var s,i,d,f,y,h,x,k,j;return c(),b("div",{key:e.id,class:"px-2"},[p("div",ke,[v(a,{src:null==(i=null==(s=e.result)?void 0:s.author)?void 0:i.avatar,class:"avatar-shadow",size:30},null,8,["src"]),p("span",je,z((null==(f=null==(d=e.result)?void 0:d.author)?void 0:f.nickname)||"无昵称"),1)]),p("div",_e,[p("span",ze,["markdown"===e.editor?(c(),m(I,{key:0,modelValue:e.content,"onUpdate:modelValue":t=>e.content=t},null,8,["modelValue","onUpdate:modelValue"])):"html"===e.editor?(c(),b("span",{key:1,innerHTML:e.content},null,8,Ve)):(c(),b("span",qe,z(e.content),1))])]),p("div",Ce,[p("div",$e,[p("span",{onClick:t=>u.setLike(e.id),class:"d-flex align-items-center font-13 pe-2 pointer"},[g(l).in.array(null==(y=n.comm.login.user)?void 0:y.id,null==(x=null==(h=e.result)?void 0:h.like)?void 0:x.uids)?(c(),m(r,{key:1,name:"like",size:"15px",color:"red",style:{"margin-bottom":"3px"}})):(c(),m(r,{key:0,name:"like-outline",size:"15px",color:"#8a8a8a",style:{"margin-bottom":"3px"}})),p("span",Le,z(null==(j=null==(k=e.result)?void 0:k.like)?void 0:j.count),1)],8,Te),p("span",{onClick:t=>u.setPid(e.id),class:"d-flex align-items-center font-13 pointer"},[v(r,{name:"comment-outline-1",size:"14px",color:"#8a8a8a"}),Ie],8,Fe)]),p("div",Ue,[p("span",null,z(g(l).natureTime(e.create_time)),1)])]),g(o).comment.pid===e.id?(c(),b("div",Me,[v(K,{"bind-id":t.modelValue,"bind-type":t.type,pid:e.id,onFinish:u.finish,class:"bg-white"},null,8,["bind-id","bind-type","pid","onFinish"])])):w("",!0)])})),128))]))])})),128))])),[[h,g(o).comment.load]]):(c(),b("div",Se,[v(r,{name:"empty",size:"168px"}),Ae])),p("div",He,[v(y,{"current-page":g(o).comment.page,"page-size":g(o).comment.limit,"page-count":g(o).comment.total,class:"mt-2",onCurrentChange:u.change,disabled:g(o).comment.load,small:"",background:"",layout:"prev, pager, next","hide-on-single-page":""},null,8,["current-page","page-size","page-count","onCurrentChange","disabled"])])])])}}},Pe={__name:"simple",props:{modelValue:{type:String,default:""}},setup(e){const t=e,s=r({show:!1,imgs:[]}),i=()=>{let e=t.modelValue.split(",");s.imgs=e.filter((e=>!l.is.empty(e)))},a=()=>"/api/file/rand?name=imgs.txt&id="+l.uuid();return h((()=>{i()})),x((()=>s.imgs),(e=>{s.show=!l.is.empty(e)})),x((()=>t.modelValue),(()=>{i()})),(e,t)=>{const l=d("el-image"),i=d("el-carousel-item"),n=d("el-carousel");return g(s).show?(c(),m(n,{key:0,height:"300px",interval:5e3},{default:u((()=>[(c(!0),b(j,null,_(g(s).imgs,((e,t)=>(c(),m(i,{key:t},{default:u((()=>[v(l,{src:e,fit:"cover",class:"w-100 pointer h-100 radius-5"},{error:u((()=>[v(l,{src:a()},null,8,["src"])])),_:2},1032,["src"])])),_:2},1024)))),128))])),_:1})):w("",!0)}}},Qe=e=>(f("data-v-a6037e11"),e=e(),y(),e),Oe={class:"container-fluid container-box px-2 px-lg-3"},Be={class:"row position-relative"},Je={key:0,class:"mutual d-lg-block d-none"},We={class:"position-fixed"},De=["onClick"],Ee={class:"col-lg-9 px-2"},Ke={class:"card mb-lg-3 mb-2"},Xe={class:"card-body"},Ye={class:"text-dark fs-2 mt-0 fw-medium"},Ze={class:"d-flex align-items-center mt-2"},Ge={class:"text-dark font-16 ms-2"},Re={class:"badge badge-outline-warning item right ms-1 scale-90"},et=Qe((()=>p("span",{class:"text-muted mx-2"},"|",-1))),tt={class:"me-1"},lt=Qe((()=>p("span",null,"发表了本文",-1))),st=["innerHTML"],it={class:"col-lg-3 sticky"},at={class:"card bg-white-only mb-lg-3 mb-2"},nt={class:"card-body p-2"},ot={class:"d-flex"},rt={class:"d-flex align-items-center justify-content-center position-relative",style:{width:"65px",height:"65px"}},dt={class:"d-flex flex-column justify-content-center ms-2"},ct={class:"font-18 text-dark d-flex align-items-center"},mt={class:"text-dark font-16 me-2"},ut={class:"badge-outline-info rounded-pill item right px-2 font-12 radius-10 d-flex align-items-center scale-90"},pt={class:"fw-bold"},vt={class:"text-secondary"},gt=Qe((()=>p("span",{class:"w-100 h-1px bg-light"},null,-1))),ft={key:0,class:"d-flex justify-content-center px-2 py-3"},yt={class:"d-flex align-items-center mx-1 pointer"},ht={class:"ms-1"},xt={class:"d-flex align-items-center mx-1 pointer"},bt={class:"ms-1"},wt={class:"d-flex align-items-center mx-1 pointer"},kt={class:"ms-1"},jt={class:"d-flex align-items-center mx-1 pointer"},_t={class:"ms-1"},zt={class:"d-flex align-items-center mx-1 pointer"},Vt={class:"ms-1"},qt={key:1,class:"card-body pt-0 py-3 px-3"},Ct=Qe((()=>p("p",{class:"mb-1 fw-medium font-14 d-flex align-items-center"},[p("span",{class:"me-1 w-4px h-10px bg-info radius-4"}),V(" 文章标签 ")],-1))),$t={class:"card box-shadow-wrap-normal mb-0"},Tt={class:"d-flex tags p-1"},Lt={key:2,class:"card-body pt-0 py-3 px-3"},Ft=Qe((()=>p("p",{class:"mb-1 fw-medium font-14 d-flex align-items-center"},[p("span",{class:"me-1 w-4px h-10px bg-info radius-4"}),V(" 文章分类 ")],-1))),It={class:"card box-shadow-wrap-normal mb-0 tags"},Ut={key:3,class:"card-body pt-0 py-3 px-3"},Mt=Qe((()=>p("p",{class:"mb-1 fw-medium font-14 d-flex align-items-center"},[p("span",{class:"me-1 w-4px h-10px bg-info radius-4"}),V(" 其它文章 ")],-1))),St={class:"card box-shadow-wrap-normal mb-0 tags"},At=["onClick"],Ht={key:4,class:"card-body pt-0 py-3 px-3"},Nt=Qe((()=>p("p",{class:"mb-1 fw-medium font-14 d-flex align-items-center"},[p("span",{class:"me-1 w-4px h-10px bg-info radius-4"}),V(" 相关文章 ")],-1))),Pt={class:"card box-shadow-wrap-normal mb-0 tags"},Qt=["onClick"],Ot=t({__name:"article[id]",setup(t){var f;const y=M(),k={comm:a()},q=r({avatar:!0,user:n.get("user-info"),id:null==(f=y.params)?void 0:f.id,load:{buy:!1,item:!1,mutual:!0,markdown:!0},struct:{},dialog:{share:!1,delivery:!1},mobile:!1,mutual:{like:{size:"20px"},share:{size:"22px"},comment:{size:"18px"},collect:{size:"22px"}},item:{progress:{}},group:{load:!1,show:!1,list:[]},tags:{load:!1,show:!1,list:[]}}),F={init:async(e=!0)=>{if(l.is.empty(q.id))return o({path:"/"});q.load.item=e;const{code:t,data:i}=await s.get("/api/article/one",{id:q.id});if(q.load.item=!1,200!==t)return o({path:"/"});"vditor"===(null==i?void 0:i.editor)&&(i.content=F.markdown(i.content)),q.struct=i,await L((()=>F.fancybox())),F.mutual.init(null==i?void 0:i.result),F.tags(),F.group()},group:async()=>{var e,t,i;q.group.load=!0;let a=[...new Set(null==(t=null==(e=q.struct)?void 0:e.group)?void 0:t.split("|").filter((e=>!l.is.empty(e))))].map((e=>parseInt(e)));if(l.is.empty(a))return q.group.load=!1,void(q.group.show=!1);let n=a.map((e=>["group",`%|${e}|%`]));const{code:o,data:r}=await s.get("/api/article/all",{like:n,limit:5,field:"id,title",not:["id",null==(i=q.struct)?void 0:i.id]});q.group.load=!1,200===o&&(q.group.show=!l.is.empty(null==r?void 0:r.data),q.group.list=null==r?void 0:r.data)},tags:async()=>{var e,t,i;q.tags.load=!0;let a=[...new Set(null==(t=null==(e=q.struct)?void 0:e.tags)?void 0:t.split("|").filter((e=>!l.is.empty(e))))].map((e=>parseInt(e)));if(l.is.empty(a))return q.tags.load=!1,void(q.tags.show=!1);let n=a.map((e=>["tags",`%|${e}|%`]));const{code:o,data:r}=await s.get("/api/article/all",{like:n,limit:5,field:"id,title",not:["id",null==(i=q.struct)?void 0:i.id]});q.tags.load=!1,200===o&&(q.tags.show=!l.is.empty(null==r?void 0:r.data),q.tags.list=null==r?void 0:r.data)},mutual:{init:(e={})=>{var t;const s=null==(t=q.user)?void 0:t.id;q.load.mutual=!0;const i=["like","comment","collect","share"];for(const a of i)"comment"===a?(q.mutual[a].count=e[a].count||0,q.mutual[a].action="rgb(var(--inis-gray))"):(q.mutual[a].ids=e[a].map((e=>parseInt(e)))||[],q.mutual[a].count=e[a].length||0,q.mutual[a].action=l.in.array(s,q.mutual[a].ids)?"rgb(var(--assist-color))":"rgb(var(--inis-gray))");q.load.mutual=!1},switch:async(e=null,t="like")=>l.in.array(t,["like","collect"])?F.mutual.submit(e,t):("share"===t&&(q.dialog.share=!0),"comment"===t?i.info("暂未开放评论功能！"):void 0),submit:async(e=null,t="like")=>{var a;const n=null==(a=q.user)?void 0:a.id;let o=l.in.array(n,q.mutual[t].ids)?0:1;const{code:r,msg:d}=await s.post("/api/exp/"+t,{bind_id:e,bind_type:"article",state:o});return 401===r?k.comm.switchAuth("login",!0):200!==r?i.error(d):void(await F.init(!1))},share:async()=>{},comment:()=>{}},markdown:t=>{const l=new e({html:!0});return q.load.markdown=!1,l.render(t)},copy:(e=null,t="")=>{l.is.empty(e)||(l.set.copy.text(e),l.is.empty(t)||i.success(t))},nature:e=>l.time.nature(e),fancybox:()=>{const e=Array.from(document.querySelectorAll(".content img"));e.map((t=>{t.classList.add("pointer"),t.addEventListener("click",(()=>{U.fromNodes(e,{Toolbar:{display:{left:["infobar"],right:["slideshow","download","thumbs","close"],middle:["zoomIn","zoomOut","toggle1to1","rotateCCW","rotateCW","flipX","flipY"]}},startIndex:e.indexOf(t)})}))}))}};return h((async()=>{q.mobile=l.is.mobile(),await F.init()})),x((()=>q.load.item),(e=>{k.comm.progress=e,e||l.to.scroll(0,0)})),x((()=>{var e;return null==(e=y.params)?void 0:e.id}),(e=>{l.is.empty(e)||(q.id=e,F.init())})),(e,t)=>{var s,i,a,n,r,f,y,h,x,k,L,I,U,M,S,A,H,N,P,Q,O,J,W,D,E,K,X,Y,Z,G,R,ee,te,le,se,ie,ae,ne,oe,re,de,ce,me,ue,pe,ve,ge;const fe=d("i-svg"),ye=d("el-badge"),he=d("el-avatar"),xe=d("i-lottie"),be=d("el-tooltip"),we=C("plyr"),ke=C("highlight"),je=C("loading");return c(),b(j,null,[p("div",Oe,[p("div",Be,[g(q).load.mutual?w("",!0):(c(),b("div",Je,[p("div",We,[(c(!0),b(j,null,_(g(q).mutual,((e,t)=>(c(),m(ye,{key:t,value:e.count,max:99,hidden:0===e.count,type:"primary",class:"item position-relative shake-little-hover"},{default:u((()=>[p("span",{onClick:e=>F.mutual.switch(g(q).struct.id,t)},[v(fe,{name:t.toString(),size:e.size,color:e.action},null,8,["name","size","color"])],8,De)])),_:2},1032,["value","hidden"])))),128))])])),$((c(),b("div",Ee,[p("div",Ke,[p("div",Xe,[p("h3",Ye,z(g(q).struct.title),1),p("div",Ze,[v(he,{src:null==(a=null==(i=null==(s=g(q).struct)?void 0:s.result)?void 0:i.author)?void 0:a.avatar,size:"small"},null,8,["src"]),p("span",Ge,z(null==(f=null==(r=null==(n=g(q).struct)?void 0:n.result)?void 0:r.author)?void 0:f.nickname),1),p("small",Re,z(null==(x=null==(h=null==(y=g(q).struct)?void 0:y.result)?void 0:h.author)?void 0:x.title),1),et,p("span",tt,z(F.nature(null==(k=g(q).struct)?void 0:k.create_time)),1),lt]),v(Pe,{modelValue:g(q).struct.covers,"onUpdate:modelValue":t[0]||(t[0]=e=>g(q).struct.covers=e),class:"mt-3"},null,8,["modelValue"]),$(p("div",{innerHTML:g(q).struct.content,class:"content markdown mt-3"},null,8,st),[[we],[ke]])])]),v(Ne,{modelValue:g(q).struct.id,"onUpdate:modelValue":t[1]||(t[1]=e=>g(q).struct.id=e),type:"article",total:null==(I=null==(L=g(q).struct.result)?void 0:L.comment)?void 0:I.count},null,8,["modelValue","total"])])),[[je,g(q).load.item]]),p("div",it,[p("div",at,[p("div",nt,[p("div",ot,[p("span",rt,[v(xe,{name:"avatar/crane",modelValue:g(q).avatar,"onUpdate:modelValue":t[2]||(t[2]=e=>g(q).avatar=e),width:"70px",height:"70px",class:"z-index-9"},null,8,["modelValue"]),v(he,{src:null==(S=null==(M=null==(U=g(q).struct)?void 0:U.result)?void 0:M.author)?void 0:S.avatar,size:52,style:{top:"10px",left:"5px"},class:"avatar-shadow position-absolute"},null,8,["src"])]),p("div",dt,[p("span",ct,[p("span",mt,z(null==(N=null==(H=null==(A=g(q).struct)?void 0:A.result)?void 0:H.author)?void 0:N.nickname),1),p("small",ut,[p("span",pt,"LV."+z(null==(D=null==(W=null==(J=null==(O=null==(Q=null==(P=g(q).struct)?void 0:P.result)?void 0:Q.author)?void 0:O.result)?void 0:J.level)?void 0:W.current)?void 0:D.value),1)])]),p("small",vt,z((null==(X=null==(K=null==(E=g(q).struct)?void 0:E.result)?void 0:K.author)?void 0:X.description)||"这个人很懒，什么都没留下！"),1)])])]),gt,g(q).load.item?w("",!0):(c(),b("div",ft,[v(be,{content:"有 "+(null==(Z=null==(Y=g(q).struct.result)?void 0:Y.like)?void 0:Z.length)+" 人点赞",disabled:!(null==(R=null==(G=g(q).struct.result)?void 0:G.like)?void 0:R.length),placement:"top"},{default:u((()=>{var e,t;return[p("span",yt,[v(fe,{name:"like",size:"14px",color:"#6c757dc4"}),p("span",ht,z((null==(t=null==(e=g(q).struct.result)?void 0:e.like)?void 0:t.length)||0),1)])]})),_:1},8,["content","disabled"]),v(be,{content:"有 "+(null==(te=null==(ee=g(q).struct.result)?void 0:ee.collect)?void 0:te.length)+" 人收藏",disabled:!(null==(se=null==(le=g(q).struct.result)?void 0:le.collect)?void 0:se.length),placement:"top"},{default:u((()=>{var e,t;return[p("span",xt,[v(fe,{name:"collect",size:"15px",color:"#6c757dc4"}),p("span",bt,z((null==(t=null==(e=g(q).struct.result)?void 0:e.collect)?void 0:t.length)||0),1)])]})),_:1},8,["content","disabled"]),v(be,{content:"有 "+g(q).struct.views+" 次浏览",disabled:!g(q).struct.views,placement:"top"},{default:u((()=>[p("span",wt,[v(fe,{name:"book-white",size:"14px",color:"#6c757dc4"}),p("span",kt,z(g(q).struct.views||0),1)])])),_:1},8,["content","disabled"]),v(be,{content:"有 "+(null==(ae=null==(ie=g(q).struct.result)?void 0:ie.comment)?void 0:ae.count)+" 条评论",disabled:!(null==(oe=null==(ne=g(q).struct.result)?void 0:ne.comment)?void 0:oe.count),placement:"top"},{default:u((()=>{var e,t;return[p("span",jt,[v(fe,{name:"comment",size:"12px",color:"#6c757dc4"}),p("span",_t,z((null==(t=null==(e=g(q).struct.result)?void 0:e.comment)?void 0:t.count)||0),1)])]})),_:1},8,["content","disabled"]),v(be,{content:"被分享了 "+(null==(de=null==(re=g(q).struct.result)?void 0:re.share)?void 0:de.length)+" 次",disabled:!(null==(me=null==(ce=g(q).struct.result)?void 0:ce.share)?void 0:me.length),placement:"top"},{default:u((()=>{var e,t;return[p("span",zt,[v(fe,{name:"share",size:"16px",color:"#6c757dc4"}),p("span",Vt,z((null==(t=null==(e=g(q).struct.result)?void 0:e.share)?void 0:t.length)||0),1)])]})),_:1},8,["content","disabled"])])),g(l).is.empty(null==(ue=g(q).struct.result)?void 0:ue.tags)?w("",!0):(c(),b("div",qt,[Ct,p("div",$t,[p("div",Tt,[(c(!0),b(j,null,_(null==(pe=g(q).struct.result)?void 0:pe.tags,(e=>(c(),b("span",{key:e.id,class:"item pointer py-1 px-2 scale-90"},[v(be,{content:e.description,disabled:!e.description,placement:"top"},{default:u((()=>[V(z(e.name),1)])),_:2},1032,["content","disabled"])])))),128))])])])),g(l).is.empty(null==(ve=g(q).struct.result)?void 0:ve.group)?w("",!0):(c(),b("div",Lt,[Ft,p("div",It,[(c(!0),b(j,null,_(null==(ge=g(q).struct.result)?void 0:ge.group,(e=>(c(),b("p",{key:e.id,class:"py-2 ps-3 mb-0 pointer item"},[v(be,{content:e.description,disabled:!e.description,placement:"top"},{default:u((()=>[p("span",null,z(e.name),1)])),_:2},1032,["content","disabled"])])))),128))])])),g(q).group.show?(c(),b("div",Ut,[Mt,$((c(),b("div",St,[(c(!0),b(j,null,_(g(q).group.list,(e=>(c(),b("p",{key:e.id,class:"py-2 ps-3 mb-0 pointer item"},[p("span",{onClick:t=>g(o)({name:"index-theme-detail",params:{id:e.id}}),class:"d-flex"},z(e.title),9,At)])))),128))])),[[je,g(q).group.load]])])):w("",!0),g(q).tags.show?(c(),b("div",Ht,[Nt,$((c(),b("div",Pt,[(c(!0),b(j,null,_(g(q).tags.list,(e=>(c(),b("p",{key:e.id,class:"py-2 ps-3 mb-0 pointer item"},[p("span",{onClick:t=>g(o)({name:"index-theme-detail",params:{id:e.id}}),class:"d-flex"},z(e.title),9,Qt)])))),128))])),[[je,g(q).tags.load]])])):w("",!0)])])])]),(c(),m(T,{to:"body"},[v(B,{modelValue:g(q).dialog.share,"onUpdate:modelValue":t[3]||(t[3]=e=>g(q).dialog.share=e),struct:g(q).struct,type:"article"},null,8,["modelValue","struct"])]))],64)}}},[["__scopeId","data-v-a6037e11"]]);export{Ot as default};
