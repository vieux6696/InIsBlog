import{V as e}from"./1711946477.vditor.js";import{a as r,n as s,u as o}from"./1711946477.index.js";import{a6 as a,y as t,w as l,aj as i,o as n,c as p,J as c,f as g,i as m,a as u,m as d,F as b,K as h,s as v}from"./1711946477.@vue.js";import{t as f}from"./1711946477.tinymce.js";import{E as w}from"./1711946477.@tinymce.js";const y={__name:"i-vditor",props:{modelValue:{type:String,default:""},opts:{type:Object,default:{height:360,toolbarConfig:{pin:!0},cache:{enable:!1}},required:!1}},setup(v,{expose:f}){const{ctx:w,proxy:y}=h(),x=a({item:e,content:"### 默认",progress:{value:0,show:!1,color:"var(--bs-dark)"}}),k={item:()=>new e(y.$refs.vditor,{cdn:j+"assets/libs/vditor",placeholder:"写点什么吧！",toolbarConfig:{pin:!0},cache:{enable:!1},counter:{enable:!0},resize:{enable:!0},preview:{hljs:{enable:!0,lineNumber:!0},math:{engine:"MathJax"}},after:()=>{x.item.setValue(V.modelValue)},upload:{accept:"image/*, video/*",multiple:!1,handler:async e=>{const o=new FormData;o.append("file",e[0]),x.progress.show=!0;const{code:a,msg:t,data:l}=await r.post("/api/file/upload",o,{onUploadProgress:e=>{x.progress.value=Math.round(e.loaded/e.total*100)}});if(200!==a)return s.error(t),x.progress.color="var(--bs-danger)",void setTimeout((()=>x.progress.show=!1),3e3);const{path:i}=l;"image"===k.fileFormat(i)?x.item.insertValue(`![](${i})`):"video"===k.fileFormat(i)?x.item.insertValue(`<video src="${i}" controls>Not Support</video>`):x.item.insertValue(`${i}`),x.progress.show=!1},filename:e=>e.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5.)]/g,"").replace(/[?\\/:|<>*\[\]()$%{}@~]/g,"").replace("/\\s/g","")},...Object.assign({},_,V.opts)}),fileFormat(e=null){let r="other";const s=e.split(".").pop();return o.in.array(s,["png","jpg","jpeg","gif","webp","svg","ico"])?r="image":o.in.array(s,["avi","mp4"])&&(r="video"),r}};let _={height:360,toolbarConfig:{pin:!0},cache:{enable:!1}};const V=v,j="/";return t((()=>{x.item=k.item()})),l((()=>V.modelValue),(e=>{var r;null==(r=x.item)||r.setValue(e)})),l((()=>x.progress.value),(e=>{e<30?x.progress.color="var(--bs-dark)":e<60?x.progress.color="var(--bs-primary)":e<100?x.progress.color="#409eff":100===e&&(x.progress.color="var(--bs-success)")})),f({getHTML:()=>{var e;return null==(e=x.item)?void 0:e.getHTML()},getValue:()=>{var e;return null==(e=x.item)?void 0:e.getValue()},html2md:e=>{var r;return null==(r=x.item)?void 0:r.html2md(e)},setValue:e=>{var r;return null==(r=x.item)?void 0:r.setValue(e)}}),(e,r)=>{const s=i("el-progress");return n(),p(b,null,[c(x).progress.show?(n(),g(s,{key:0,percentage:c(x).progress.value,color:c(x).progress.color},null,8,["percentage","color"])):m("",!0),u("div",d(e.$attrs,{ref:"vditor"}),null,16)],64)}}},x={__name:"i-tinymce",props:{opts:{type:Object,default:{},required:!1}},setup(e){const u=e,h=a({init:{placeholder:"请输入内容 ...",promotion:!1,height:600,base_url:"/assets/libs/tinymce",plugins:"lists link image table code wordcount help",mobile:{menubar:!0},language:"zh-Hans",browser_spellcheck:!0,branding:!1,elementpath:!1,statusbar:!1,convert_urls:!1,content_style:`\n            * { color: rgb(${o.get.css.var("--theme-font-color")}); }\n            html{scrollbar-width: thin;scrollbar-color: rgba(0,0,0,.2) transparent;}\n            html::-webkit-scrollbar{width:4px;height:10px;background-color:rgba(0,0,0,0);}\n            html::-webkit-scrollbar-thumb{border-radius:6px;background-color:rgba(0,0,0,.2);transition:all .4s ease;-moz-transition:all .4s ease;-webkit-transition:all .4s ease;-o-transition:all .4s ease}\n            html::-webkit-scrollbar-track{background-color:rgba(0,0,0,.1)}\n        `,fontsize_formats:"14px 16px 18px 20px 24px 26px 28px 30px 32px 36px",font_formats:"微软雅黑=Microsoft YaHei,Helvetica Neue;PingFang SC;sans-serif;苹果苹方=PingFang SC,Microsoft YaHei,sans-serif;宋体=simsun;serifsans-serif;Terminal=terminal;monaco;Times New Roman=times new roman;times",file_picker_types:"image",images_upload_credentials:!0,images_upload_handler:async e=>{try{const o=new FormData;o.append("file",e.blob()),h.progress.show=!0;const{data:a,code:t,msg:l}=await r.post("/api/file/upload",o,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{h.progress.value=Math.round(e.loaded/e.total*100)}});200!==t&&(s.error(l),h.progress.color="var(--bs-danger)",setTimeout((()=>h.progress.show=!1),3e3));const{path:i}=a;return h.progress.show=!1,i}catch(o){s.error(o),h.progress.color="var(--bs-danger)",setTimeout((()=>h.progress.show=!1),3e3)}},...u.opts},progress:{value:0,show:!1,color:"var(--bs-dark)"}});return t((async()=>{await f.init({})})),l((()=>h.progress.value),(e=>{e<30?h.progress.color="var(--bs-dark)":e<60?h.progress.color="var(--bs-primary)":e<100?h.progress.color="#409eff":100===e&&(h.progress.color="var(--bs-success)")})),(e,r)=>{const s=i("el-progress");return n(),p(b,null,[c(h).progress.show?(n(),g(s,{key:0,percentage:c(h).progress.value,color:c(h).progress.color},null,8,["percentage","color"])):m("",!0),v(c(w),d(e.$attrs,{init:c(h).init}),null,16,["init"])],64)}}};export{x as _,y as a};
