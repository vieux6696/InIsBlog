import{u as e,_ as t,p as a,a as s,b as l,e as i,n,c as o}from"./1711946477.index.js";import{a6 as r,y as c,aj as d,o as m,c as p,J as u,f as g,a2 as f,s as v,F as y,g as x,a as b,a0 as h,as as w,a3 as _,q as k,l as j,n as V,i as C,aA as z,aB as L,w as I,T as D,K as $}from"./1711946477.@vue.js";import{u as M}from"./1711946477.vue-router.js";/* empty css                                                                  */import{o as U}from"./1711946477.colorthief.js";import{d as T}from"./1711946477.pinia.js";import"./1711946477.lscache.js";import"./1711946477.crypto-js.js";import"./1711946477.axios.js";import"./1711946477.element-plus.js";import"./1711946477.lodash-es.js";import"./1711946477.@element-plus.js";import"./1711946477.@popperjs.js";import"./1711946477.@ctrl.js";import"./1711946477.dayjs.js";import"./1711946477.async-validator.js";import"./1711946477.memoize-one.js";import"./1711946477.normalize-wheel-es.js";import"./1711946477.@floating-ui.js";import"./1711946477.notyf.js";import"./1711946477.lottie-web.js";import"./1711946477.bootstrap.js";import"./1711946477.plyr.js";import"./1711946477.@fancyapps.js";import"./1711946477.highlight.js.js";import"./1711946477.@howdyjs.js";const A={class:"position-relative"},H={class:"position-absolute top-0 start-0 end-0 p-2"},B={class:"cover-shadow"},S={__name:"cover",props:{modelValue:{type:String,default:""}},setup(t){const a=t,s=r({type:"rand",imgs:[]}),l=()=>{let t=a.modelValue.split(",");s.imgs=t.filter((t=>!e.is.empty(t))),e.is.empty(s.imgs)?s.type="rand":1===s.imgs.length?s.type="image":s.type="carousel"},i=()=>"/api/file/rand?name=imgs.txt&id="+e.uuid();return c((()=>{l()})),(e,t)=>{const a=d("el-image"),l=d("el-carousel-item"),n=d("el-carousel");return m(),p("div",A,["rand"===u(s).type?(m(),g(a,{key:0,src:i(),style:{height:"200px"},class:"w-100 d-block pointer radius-4",fit:"cover"},{error:f((()=>[v(a,{src:i()},null,8,["src"])])),_:1},8,["src"])):"image"===u(s).type?(m(),g(a,{key:1,src:u(s).imgs[0],style:{height:"200px"},class:"w-100 d-block pointer radius-4",fit:"cover"},{error:f((()=>[v(a,{src:i()},null,8,["src"])])),_:1},8,["src"])):(m(),g(n,{key:2,height:"200px",direction:"vertical",interval:5e3},{default:f((()=>[(m(!0),p(y,null,x(u(s).imgs,((e,t)=>(m(),g(l,{key:t},{default:f((()=>[v(a,{src:e,fit:"cover",class:"w-100 pointer h-100 radius-4"},{error:f((()=>[v(a,{src:i()},null,8,["src"])])),_:2},1032,["src"])])),_:2},1024)))),128))])),_:1})),b("div",H,[h(e.$slots,"header")]),b("div",B,[h(e.$slots,"footer")])])}}},q={__name:"image-text",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e;return(e,t)=>{const s=d("el-skeleton-item"),l=d("el-skeleton"),i=d("el-space");return m(),g(i,{class:"w-100",direction:"vertical",alignment:"flex-start"},{default:f((()=>[v(l,{loading:a.modelValue,animated:""},{template:f((()=>[v(s,{variant:"image",style:{height:"200px"}}),v(s,{variant:"text",class:"w-50 mt-2 pb-0 h-18px d-block"})])),default:f((()=>[h(e.$slots,"default")])),_:3},8,["loading"])])),_:3})}}},E=e=>(z("data-v-cf7572c0"),e=e(),L(),e),F={class:"d-flex mb-lg-3 mb-2 position-relative"},G={class:"el-dropdown-link d-flex align-items-center"},J={class:"d-flex"},K=["onClick"],R={class:"d-flex align-items-center"},N={class:"px-1"},O={class:"d-flex position-absolute end-0"},P={class:"row"},Q={class:"card mb-lg-3 mb-2 ribbon-box"},W={class:"card-body p-2"},X={key:0,class:"ribbon-two ribbon-two-danger"},Y=[E((()=>b("span",{class:"fw-medium"},"置顶",-1)))],Z={class:"d-flex"},ee={class:"d-flex align-items-center"},te={class:"ms-1"},ae={class:"d-flex align-items-center ms-2"},se={class:"ms-1"},le={class:"mb-0 mt-2 limit-1-line"},ie={key:1,class:"col-lg-12"},ne={class:"card card-body mb-0 d-flex align-items-center flex-column"},oe=E((()=>b("p",{class:"separator mb-0 text-muted"},"暂无内容",-1))),re=t({__name:"post",setup(t){M();const l=r({article:{list:[],order:"top desc, views desc",like:[],load:!1},group:{action:null,list:[],load:!1},page:{show:!1,code:1,limit:6,total:1},item:{sort:"排序"}}),i={init:async(e=l.page.code)=>{l.article.load=!0;const t={page:e,limit:l.page.limit,order:l.article.order,like:l.article.like,where:"audit = 1"},{data:a}=await s.get("/api/article/all",t);l.article.load=!1,l.article.list=a.data,l.page.total=a.page,l.page.code=parseInt(e)},group:async()=>{l.group.load=!0;const{data:e}=await s.get("/api/article-group/column",{field:"id,name,avatar,description"});l.group.load=!1,l.group.list=e},order(e="create_time asc",t="排序"){l.item.sort=t,l.article.order=e,i.init(l.page.code)},refresh:()=>{l.article.like=[],l.group.action=null,i.init(l.page.code),i.group()},like:async(t=null)=>{e.is.empty(t)||(l.group.action=t,l.article.like=["group",`%|${t}|%`],await i.init())}};return c((()=>{i.init(l.page.code),i.group()})),(t,s)=>{const n=d("i-svg"),o=d("el-dropdown-item"),r=d("el-dropdown"),c=d("el-avatar"),h=d("el-tooltip"),z=d("el-scrollbar"),L=w("loading");return m(),p(y,null,[b("div",F,[v(r,{class:"custom mimic me-1 text-ls-6px radius-5 scroll-item",trigger:"click"},{dropdown:f((()=>[v(o,{onClick:s[0]||(s[0]=e=>i.order("top desc, views desc","热门"))},{default:f((()=>[_("热门")])),_:1}),v(o,{onClick:s[1]||(s[1]=e=>i.order("top desc, create_time desc","最新"))},{default:f((()=>[_("最新")])),_:1}),v(o,{onClick:s[2]||(s[2]=e=>i.order("top desc, create_time asc","最早"))},{default:f((()=>[_("最早")])),_:1})])),default:f((()=>[b("span",G,[_(k(u(l).item.sort)+" ",1),v(n,{name:"down"})])])),_:1}),j((m(),g(z,{style:{"max-width":"calc(100% - 130px)"}},{default:f((()=>[b("div",J,[(m(!0),p(y,null,x(u(l).group.list,(t=>(m(),p("button",{key:t.id,onClick:e=>i.like(t.id),type:"button",class:V("btn mx-1 btn-auto mimic radius-5 scroll-item"+(u(l).group.action===t.id?" action":""))},[v(h,{disabled:u(e).is.empty(t.description),content:t.description,placement:"top"},{default:f((()=>[b("div",R,[u(e).is.empty(t.avatar)?C("",!0):(m(),g(c,{key:0,src:t.avatar,size:16},null,8,["src"])),b("span",N,k(t.name),1)])])),_:2},1032,["disabled","content"])],10,K)))),128))])])),_:1})),[[L,u(l).group.load]]),b("div",O,[v(h,{content:"刷新",placement:"top"},{default:f((()=>[b("button",{onClick:s[3]||(s[3]=(...e)=>i.refresh&&i.refresh(...e)),class:"btn btn-auto mimic radius-5 scrollbar-demo-item",type:"button"},[v(n,{name:"refresh"})])])),_:1})])]),b("div",P,[u(e).is.empty(u(l).article.list)?j((m(),p("div",ie,[b("div",ne,[v(n,{name:"empty",size:"168px"}),oe])])),[[L,u(l).article.load]]):(m(!0),p(y,{key:0},x(u(l).article.list,(t=>(m(),p("div",{key:t.id,class:"col-lg-6"},[b("div",Q,[b("div",W,[1!==t.top||u(l).article.load?C("",!0):(m(),p("div",X,Y)),v(q,{modelValue:u(l).article.load,"onUpdate:modelValue":s[4]||(s[4]=e=>u(l).article.load=e)},{default:f((()=>[v(S,{modelValue:t.covers,"onUpdate:modelValue":e=>t.covers=e,class:"mask pointer",onClick:e=>u(a)({name:"index-article-detail",params:{id:t.id}})},{footer:f((()=>{var a,s;return[b("span",Z,[b("span",ee,[v(n,{name:"book",size:"14px",color:"rgb(var(--article-color))"}),b("span",te,k(t.views||0),1)]),b("span",ae,[v(n,{name:"comment-outline",size:"18px",color:"rgb(var(--article-color))"}),b("span",se,k((null==(s=null==(a=t.result)?void 0:a.comment)?void 0:s.count)||0),1)])]),b("span",null,k(u(e).natureTime(t.last_update||t.update_time)),1)]})),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),b("p",le,k(t.title),1)])),_:2},1032,["modelValue"])])])])))),128))])],64)}}},[["__scopeId","data-v-cf7572c0"]]),ce={key:0,class:"flex-center"},de=b("span",{class:"fw-medium fs-3"},"已签到，经验值 +30",-1),me={key:1,class:"flex-center"},pe=b("span",{class:"fw-medium fs-3 ms-2"},"签到领奖励！",-1),ue=b("span",null,"本月签到",-1),ge={class:"modal-footer d-flex justify-content-center"},fe={__name:"sign-in",setup(t){const a={comm:l()},o=r({item:{wait:!1,finish:!0},date:new Date,days:[]}),y={init:async()=>{const e=y.range(),{code:t,data:l}=await s.get("/api/exp/column",{where:[["state","=",1],["type","=","check-in"],["uid","=",a.comm.login.user.id],["create_time",">=",e[0]],["create_time","<=",e[1]]],field:"id,value,create_time"});200===t&&(o.days=Array.from(new Set(l.map((e=>new Date(1e3*e.create_time).getDate())))))},day:e=>parseInt(e.day.split("-").slice(2).join("-")),signIn:async()=>{o.item.wait=!0;const{code:e,msg:t}=await s.post("/api/exp/check-in");if(o.item.wait=!1,200!==e)return n.error(t);n.info(t),await y.init()},range:()=>{const[e,t]=[new Date,new Date];return e.setDate(1),e.setHours(0,0,0,0),t.setMonth(t.getMonth()+1,1),t.setHours(0,0,0,0),[Math.floor(e.getTime()/1e3),Math.floor(t.getTime()/1e3)-1]},today:()=>(new Date).getDate()};return c((async()=>{await y.init()})),(t,a)=>{const s=d("i-svg"),l=d("el-calendar"),n=d("el-button"),r=d("el-dialog");return m(),g(r,{modelValue:u(o).item.dialog,"onUpdate:modelValue":a[3]||(a[3]=e=>u(o).item.dialog=e),"show-close":!1,class:"custom sm"},{header:f((()=>[u(e).in.array(y.today(),u(o).days)?(m(),p("div",ce,[v(i,{name:"finish",modelValue:u(o).item.finish,"onUpdate:modelValue":a[0]||(a[0]=e=>u(o).item.finish=e),width:"70px",height:"70px"},null,8,["modelValue"]),de])):(m(),p("div",me,[v(s,{name:"check-in",size:"50px"}),pe]))])),default:f((()=>[v(l,{modelValue:u(o).date,"onUpdate:modelValue":a[1]||(a[1]=e=>u(o).date=e),class:"sign-in mx-3 radius-10"},{header:f((({date:e})=>[ue,b("span",null,k(e),1)])),"date-cell":f((({data:t})=>[b("span",{class:V(u(e).in.array(y.day(t),u(o).days)?"check-in":"")},k(y.day(t)),3)])),_:1},8,["modelValue"])])),footer:f((()=>[b("div",ge,[u(e).in.array(y.today(),u(o).days)?C("",!0):(m(),g(n,{key:0,onClick:a[2]||(a[2]=e=>y.signIn()),loading:u(o).item.wait},{default:f((()=>[_(k(u(o).item.wait?"签 到 中 ...":"立 即 签 到"),1)])),_:1},8,["loading"]))])])),_:1},8,["modelValue"])}}},ve=e=>(z("data-v-8245bfd6"),e=e(),L(),e),ye={class:"card mb-0"},xe={class:"card-body"},be={key:0,class:"d-flex justify-content-between"},he={class:"d-flex align-items-center"},we=ve((()=>b("div",{class:"d-flex flex-column ms-2"},[b("span",{class:"font-18 text-dark"},"您好！"),b("small",{class:"text-muted"},"登录做任务领算粒")],-1))),_e={key:1,class:"d-flex justify-content-between"},ke={class:"d-flex align-items-center"},je={class:"d-flex flex-column ms-2"},Ve={class:"font-18 text-dark d-flex align-items-center"},Ce={class:"badge-outline-info rounded-pill item right px-2 font-12 radius-10 d-flex align-items-center ms-2"},ze={class:"fw-bold"},Le={class:"text-muted"},Ie={class:"d-flex justify-content-between mt-4 px-3"},De=ve((()=>b("span",{class:"mt-2"},"个人中心",-1))),$e={class:"d-flex flex-column align-items-center"},Me=ve((()=>b("span",{style:{"margin-top":"0.74rem!important"}},"我的喜欢",-1))),Ue=ve((()=>b("span",{style:{"margin-top":"0.46rem!important"}},"每日签到",-1))),Te=ve((()=>b("div",{class:"h-1px bg-light my-3"},null,-1))),Ae=ve((()=>b("div",{class:"d-flex justify-content-around px-3 font-16 position-relative"},[b("div",null,"BUG反馈"),b("span",{class:"line position-absolute"}),b("div",null,"我的建议")],-1))),He=t({__name:"base-info",setup(t){M();const s={comm:l()},i=r({item:{signIn:!1}}),n={login:{show:()=>{s.comm.switchAuth("login",!0)}},signIn:()=>{if(!s.comm.getLogin.finish)return s.comm.switchAuth("login",!0);i.item.signIn=!0},compute:()=>{if(!s.comm.getLogin.finish)return s.comm.switchAuth("login",!0);a("/admin/account/home")}};return(t,a)=>{var l,o;const r=d("i-svg"),c=d("el-button"),x=d("el-avatar");return m(),p(y,null,[b("div",ye,[b("div",xe,[s.comm.getLogin.finish?(m(),p("div",_e,[b("div",ke,[b("div",null,[v(x,{src:s.comm.getLogin.user.avatar,fit:"cover",size:"large",class:"avatar-shadow mirror-scan"},null,8,["src"])]),b("div",je,[b("span",Ve,[b("span",null,k(s.comm.getLogin.user.nickname),1),b("small",Ce,[u(e).is.empty(null==(l=s.comm.getLogin.user)?void 0:l.gender)?C("",!0):(m(),g(r,{key:0,name:null==(o=s.comm.getLogin.user)?void 0:o.gender,size:"18px",class:"me-1"},null,8,["name"])),b("span",ze,"Lv."+k(s.comm.getLogin.user.result.level.current.value),1)])]),b("small",Le,k(s.comm.getLogin.user.description||"这个人很懒，什么都没留下！"),1)])])])):(m(),p("div",be,[b("div",he,[v(r,{name:"avatar",size:"40px"}),we]),v(c,{onClick:n.login.show,type:"primary",size:"small"},{default:f((()=>[_("签到 +5")])),_:1},8,["onClick"])])),b("div",Ie,[b("div",{onClick:a[0]||(a[0]=e=>n.compute()),class:"d-flex flex-column align-items-center pointer"},[v(r,{name:"integral",size:"30px",color:"rgb(var(--assist-color))"}),De]),b("div",$e,[v(r,{name:"work",size:"30px",color:"rgb(var(--assist-color))"}),Me]),b("div",{onClick:a[1]||(a[1]=e=>n.signIn()),class:"d-flex flex-column align-items-center pointer"},[v(r,{name:"sign-in",size:"33px",color:"rgb(var(--assist-color))"}),Ue])]),Te,Ae])]),v(fe,{modelValue:u(i).item.signIn,"onUpdate:modelValue":a[2]||(a[2]=e=>u(i).item.signIn=e)},null,8,["modelValue"])],64)}}},[["__scopeId","data-v-8245bfd6"]]),Be={key:0,class:"card mb-0 mt-2 mt-lg-3"},Se={class:"card-header d-flex justify-content-between py-3 ps-3 bg-image"},qe={class:"font-16 line-height-20 text-dark"},Ee={class:"card-body p-2"},Fe=["innerHTML"],Ge={class:"d-flex flex-column ms-2"},Je={class:"d-flex align-items-center"},Ke={class:"font-15 fw-medium text-dark me-1"},Re={class:"position-absolute end-0 fs-bolder"},Ne={class:"flex-center"},Oe={class:"bg-white p-3 radius-10"},Pe=b("p",{class:"mb-0"},"完成以下每日任务，可以获得对应的经验值",-1),Qe={__name:"ranking",setup(t){const a=r({item:{dialog:!1},active:{load:!1,show:!1,list:[]},month:null,rules:[{name:"签到",exp:30,count:1},{name:"登录",exp:5,count:1},{name:"点赞",exp:1,count:10},{name:"收藏",exp:1,count:10},{name:"访问",exp:1,count:10},{name:"分享",exp:1,count:10},{name:"评论",exp:1,count:10}]}),l=async()=>{a.active.load=!0;const{code:e,data:t}=await s.get("/api/exp/active",{limit:8});a.active.load=!1,200===e&&(a.active.list=t)},i=(e=1)=>{let t={};switch(e){case 1:t={text:"1st",color:"var(--bs-pink)"};break;case 2:t={text:"2nd",color:"var(--bs-orange)"};break;case 3:t={text:"3rd",color:"var(--bs-green)"};break;default:t={text:e+"th",color:"var(--bs-gray)"}}return`<span style="color: ${t.color};"><span class="fw-bold">${t.text}</span></span>`},n=()=>{const e=new Date;a.month=e.getMonth()+1};return c((()=>{l(),n()})),I((()=>a.active.list),(t=>{a.active.show=!e.is.empty(t)})),(t,s)=>{const l=d("el-avatar"),n=d("el-tooltip"),o=d("el-image"),r=d("el-alert"),c=d("el-table-column"),h=d("el-table"),z=d("el-dialog"),L=w("loading");return m(),p(y,null,[u(a).active.show?j((m(),p("div",Be,[b("div",Se,[b("span",qe,k(u(a).month)+"月社区贡献榜",1),b("span",{onClick:s[0]||(s[0]=e=>u(a).item.dialog=!0),class:"font-13 text-info fw-medium pointer"},"如何上榜")]),b("div",Ee,[(m(!0),p(y,null,x(u(a).active.list,((t,a)=>(m(),p("div",{key:t.id,class:"my-2 d-flex align-items-center position-relative"},[b("span",{innerHTML:i(a+1),style:{width:"30px"}},null,8,Fe),v(n,{content:`${t.nickname}：${t.description}`,disabled:!t.description,placement:"right"},{default:f((()=>[v(l,{src:t.avatar,size:40,class:V("avatar-shadow "+(t.description?"pointer":""))},null,8,["src","class"])])),_:2},1032,["content","disabled"]),b("span",Ge,[b("span",Je,[b("span",Ke,k(t.nickname),1)]),b("small",null,"本月活跃 "+k(u(e).format.number(t.count))+" 次",1)]),b("span",Re,k(u(e).format.number(t.exp||0)),1)])))),128))])])),[[L,u(a).active.load]]):C("",!0),(m(),g(D,{to:"body"},[v(z,{modelValue:u(a).item.dialog,"onUpdate:modelValue":s[1]||(s[1]=e=>u(a).item.dialog=e),class:"custom"},{header:f((()=>[b("div",Ne,[v(o,{src:"/assets/imgs/logo-white.png",style:{height:"52px"},class:"my-1 py-1"})])])),default:f((()=>[b("div",Oe,[v(r,{type:"success",closable:!1,class:"mb-3"},{title:f((()=>[Pe])),_:1}),v(h,{data:u(a).rules,stripe:"",style:{width:"100%"},class:"custom simple"},{default:f((()=>[v(c,{prop:"name",label:"名称"}),v(c,{prop:"exp",label:"经验值"},{default:f((e=>[_(" +"+k(e.row.exp),1)])),_:1}),v(c,{prop:"count",label:"次/日"})])),_:1},8,["data"])])])),_:1},8,["modelValue"])]))],64)}}},We=T("banner",{state:()=>({current:{}}),getters:{getCurrent:(e={})=>((e={})=>{const t="banner-current";if(o.has(t))return e.tree=o.get(t);const a=Math.round(new Date/1e3);s.get("/api/banner/column",{where:[["start_time","<=",a],["end_time",">=",a]]}).then((({code:a,data:s})=>{200===a&&(e.current=s,o.set(t,s,inis.cache))}))})(e)},actions:{async setCurrent(){const e="banner-current";if(o.has(e))return this.current=o.get(e),{code:200,msg:"cache",data:this.current};const t=Math.round(new Date/1e3),{code:a,msg:l,data:i}=await s.get("/api/banner/column",{where:[["start_time","<=",t],["end_time",">=",t]]});return 200===a?(this.current=i,o.set(e,i,inis.cache),{code:a,msg:l,data:i}):void 0}}}),Xe={class:"title mb-3 ms-3"},Ye={key:0,class:"font-white font-17 me-2"},Ze={key:1,class:"font-white font-17"},et={__name:"color-thief",setup(t){const{ctx:a,proxy:s}=$();M();const l={banner:We()},i=r({banner:{show:!1,list:l.banner.getCurrent}}),n={init:async()=>{await n.banner()},load:async(e,t)=>{const a=await(new U).getColor(e);s.$refs["carousel-footer"][t].style.background=`rgb(${a.join(",")})`},banner:async()=>{const{data:t}=await l.banner.setCurrent();e.is.empty(t)||(i.banner.show=!0,i.banner.list=t)},jump:(t="",a="_blank")=>{new RegExp(/^(https?:\/\/)?([\w.-]+)\.([a-z]{2,6}\.?)(\/[\w.-]*)*\/?(\?[\w.-=&]*)?$/i).test(t)&&(e.in.array(a,["_self","_blank","_parent","_top"])||(a="_blank"),window.open(t,a))}};return c((async()=>{await n.init()})),(t,a)=>{const s=d("el-image"),l=d("el-carousel-item"),o=d("el-carousel"),r=w("loading");return u(i).banner.show?j((m(),g(o,{key:0,interval:1e4,trigger:"click",height:"250px",class:"color-thief",arrow:"always"},{default:f((()=>[(m(!0),p(y,null,x(u(i).banner.list,((t,a)=>(m(),g(l,{key:t.id},{default:f((()=>[v(s,{onLoad:e=>n.load(e.target,a),onClick:e=>n.jump(t.url,t.target),src:t.image,crossorigin:"anonymous",fit:"cover",class:"w-100 pointer",style:{height:"230px"}},null,8,["onLoad","onClick","src"]),b("div",{class:"carousel-footer",ref_for:!0,ref:"carousel-footer"},[b("p",Xe,[u(e).is.empty(t.title)?C("",!0):(m(),p("span",Ye,k(t.title),1)),u(e).is.empty(t.title)?C("",!0):(m(),p("span",Ze,k(t.content),1))])],512)])),_:2},1024)))),128))])),_:1})),[[r,!u(i).banner.show]]):C("",!0)}}},tt={class:"container-fluid container-box px-2 px-lg-3"},at={class:"row"},st={class:"col-lg-9 px-2"},lt={class:"col-lg-3 sticky"},it=t({__name:"index",setup:e=>(M(),r({}),(e,t)=>(m(),p("div",tt,[b("div",at,[b("div",st,[v(et,{class:"mb-3"}),v(re)]),b("div",lt,[v(He),v(Qe)])])])))},[["__scopeId","data-v-5e6be852"]]);export{it as default};
