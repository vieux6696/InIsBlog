import{a as s,n as a}from"./1711946477.index.js";import{a6 as t,y as l,w as e,aj as n,as as o,o as i,c,l as u,J as d,a as r,s as m,a2 as p,a3 as g,F as f}from"./1711946477.@vue.js";const b={class:"card mb-3"},v={class:"card-body"},h={class:"text-muted text-uppercase mt-0"},x=r("strong",{class:"text-success"},"开启后满足条件的客户端IP会被自动拉黑！",-1),w=r("br",null,null,-1),S=r("br",null,null,-1),_=r("br",null,null,-1),y=r("br",null,null,-1),P=r("br",null,null,-1),V={class:"d-inline-flex align-items-center"},j=r("span",{class:"ms-1"},"自动 IP 黑名单",-1),k={class:"m-b-20"},C=r("span",{class:"badge bg-primary font-white"}," +30% ",-1),I={class:"text-muted ms-1"},Q=r("strong",{class:"flex-center"},"配置",-1),O={class:"row"},z={class:"col-md-6"},U={class:"form-group mb-3"},B={class:"form-label"},E=r("span",{class:"ms-1"},"触发次数：",-1),K={class:"col-md-6"},L={class:"form-group mb-3"},M={class:"form-label"},T=r("span",{class:"ms-1"},"时间频率（秒）：",-1),Y={__name:"qps-black",setup(Y,{expose:D}){const J=t({struct:{value:0,json:{count:null,second:""}},status:{finish:!1,active:!1,dialog:!1,loading:!0,wait:!1}});l((async()=>{await q.init()}));const q={init:async()=>{J.status.finish=!1,J.status.loading=!0;const{code:a,data:t}=await s.get("/api/config/one",{key:"SYSTEM_QPS_BLOCK"});J.status.loading=!1,200===a&&(J.struct=t,J.status.finish=!0)},show(){if(!J.status.finish)return a.warn("配置获取失败，无法进行配置！");J.status.dialog=!0},change:async t=>{const{code:l,msg:e}=await s.post("/api/config/save",{key:"SYSTEM_QPS_BLOCK",value:t?1:0});200!==l&&(J.status.active=!t,a.error(e))},save:async()=>{J.status.wait=!0;const{code:t,msg:l}=await s.post("/api/config/save",{key:"SYSTEM_QPS_BLOCK",json:JSON.stringify(J.struct.json)});if(J.status.wait=!1,200!==t)return a.error("保存失败："+l);J.status.dialog=!1}};return e((()=>J.struct),(()=>{J.status.active=1===parseInt(J.struct.value),J.struct.expire=J.struct.json.second.replace(/[^\d\s*+\-\/]/g,"")}),{deep:!0}),D({init:q.init}),(s,a)=>{const t=n("i-svg"),l=n("el-tooltip"),e=n("el-switch"),Y=n("el-input-number"),D=n("el-input"),A=n("el-button"),F=n("el-dialog"),N=o("loading");return i(),c(f,null,[u((i(),c("div",b,[r("div",v,[m(t,{name:"black",size:"58px",color:"rgb(var(--assist-color))",class:"position-absolute opacity-25",style:{right:"1.5rem"}}),r("h6",h,[m(l,{placement:"top"},{content:p((()=>[x,w,g(" ● 此功能需要搭配 QPS 使用，在 时间频率 内，达到 触发 QPS 次数上限，自动拉黑对应的客户端IP"),S,g(" ● 如：在1小时内，某客户端IP触发了3次 QPS 警告，则自动拉黑此客户端IP，并且后续无法访问任何API"),_,g(" ● 此功能可以有效防止恶意攻击，如：CC攻击、DDOS攻击等"),y,g(" ● 需要注意的是，随机图片接口也会受到影响"),P])),default:p((()=>[r("span",V,[m(t,{name:"hint",color:"rgb(var(--icon-color))",size:"14px"}),j])])),_:1})]),r("h2",k,[m(e,{modelValue:d(J).status.active,"onUpdate:modelValue":a[0]||(a[0]=s=>d(J).status.active=s),onChange:q.change,disabled:!d(J).status.finish,"active-text":"我怂","inactive-text":"无所畏惧"},null,8,["modelValue","onChange","disabled"])]),C,r("span",I,[g(" 安全性提升，"),r("span",{onClick:a[1]||(a[1]=s=>q.show()),class:"text-dark pointer"},"点我配置")])])])),[[N,d(J).status.loading]]),m(F,{modelValue:d(J).status.dialog,"onUpdate:modelValue":a[6]||(a[6]=s=>d(J).status.dialog=s),class:"custom",draggable:"","close-on-click-modal":!1},{header:p((()=>[Q])),default:p((()=>[r("div",O,[r("div",z,[r("div",U,[r("label",B,[m(l,{content:"触发QPS的次数，推荐：3",placement:"top"},{default:p((()=>[r("span",null,[m(t,{name:"hint",size:"14px"}),E])])),_:1})]),m(Y,{modelValue:d(J).struct.json.count,"onUpdate:modelValue":a[2]||(a[2]=s=>d(J).struct.json.count=s),min:1,class:"w-100 d-flex"},null,8,["modelValue"])])]),r("div",K,[r("div",L,[r("label",M,[m(l,{content:"可以用乘法，如：60 * 60 表示1小时",placement:"top"},{default:p((()=>[r("span",null,[m(t,{name:"hint",size:"14px"}),T])])),_:1})]),m(D,{modelValue:d(J).struct.json.second,"onUpdate:modelValue":a[3]||(a[3]=s=>d(J).struct.json.second=s)},null,8,["modelValue"])])])])])),footer:p((()=>[m(A,{onClick:a[4]||(a[4]=s=>d(J).status.dialog=!1)},{default:p((()=>[g("取 消")])),_:1}),m(A,{onClick:a[5]||(a[5]=s=>q.save()),loading:d(J).status.wait},{default:p((()=>[g("保 存")])),_:1},8,["loading"])])),_:1},8,["modelValue"])],64)}}};export{Y as _};
